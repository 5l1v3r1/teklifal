<% unless @announcement.published? %>
  <div class="alert alert-warning" role="alert">
    <%= t '.expired' %>
  </div>
<% end %>

<div class="border-bottom d-flex">
  <h3 class="h5 pt-1"><%= @announcement.title %></h3>
  <% unless @announcement.expired? %>
    <div class="ml-3">
      <span class="badge badge-success"><%= t '.waiting_for_offers' %></span>
    </div>
  <% end %>

  <% if policy(@announcement).edit? %>
    <div class="dropdown ml-auto make-something">
      <button class="btn btn-sm btn-primary dropdown-toggle"
        id="actions-button"
        type="button"
        data-toggle="dropdown"
        data-trigger="manual"
        aria-haspopup="true"
        aria-expanded="false"
        data-toggle="popover"
        data-content="<%= t '.actions_popover_content' %>">
        <%= t 'common.actions' %>
      </button>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
          <%= link_to t('common.edit'), edit_announcement_path(@announcement), class: "dropdown-item" %>
          <%= link_to t('announcements.expire'),
                      expire_announcement_path(@announcement), 
                      method: :put,
                      data: { confirm: t('announcements.expire_are_you_sure')},
                      class: "dropdown-item"  %>
      </div>
    </div>
  <% end %>
</div>

<%= render @announcement %>


<div class="mt-5 border-bottom">
  <% if policy(@announcement).new_offer? %>
    <%= link_to t('offers.make_an_offer'),
                new_announcement_offer_path(@announcement),
                class: "btn btn-primary float-right"  %>
  <% elsif user_signed_in? and offer = current_user.offer_for('draft', @announcement) %>
    <%= link_to t('offers.continue_to_the_draft'),
                [:edit, @announcement, offer],
                class: "btn btn-warning float-right"  %>
  <% elsif user_signed_in? and offer = current_user.offer_for('published', @announcement) %>
    <span class="float-right text-success">
      <%= t 'offer.already_offer' %>
      <%= link_to t('offers.edit'), [:edit, @announcement, offer] %>
      <i class="material-icons text-success">done</i>
    </span>
  <% end %>

  <h3 class="h5 pt-3"><%= t "offers.offers" %></h3>
</div>

<%= (render @announcement.offers.where(state: 'published')) or 
  content_tag(:p, t('offers.no_offer'), class: "text-center text-muted mt-4") %>